-- This is the installer for disks.
-- It does not contain any install data itself, only connects to a static git path and downloads the webInstaller
-- NOTE: This is the only script that has to be brought into Minecraft CC manually.
--		 Copy it to a disk and get started.

-- 1. check if extOS is present, check version => ask on overwrite

term.clear()
term.setCursorPos(1, 1)

print("	            ***************************")
print("		           ***** extOS Installer *****")
print("		           ***************************")
print("")

local function printWithDots(str, loops)
	local dots = ""
	local dotsCount = 1
	local x, y = term.getCursorPos()
	for i = 1, loops do
	    if dotsCount < 4 then
		    dots = dots.."."
			dotsCount = dotsCount + 1
		else
		    print("RESET")
			dots = ""
			dotsCount = 1
		end
	    term.setCursorPos(1, y)
		term.write(i.." "..str.." "..dots)
		sleep(0.5)
	end
	print("")
end

sleep(1)

local mainPath = "https://raw.githubusercontent.com/phil1025/ComputerCraft/main/"
local webInstallerPath = "SourceCode/extOS/extOS_WebInstaller"
local download = http.get(mainPath..webInstallerPath)

local installData = nil
if download then
	
	installData = download.readAll()
	download.close()
	
	local filePath = "temp_extOS_WebInstaller"
	
	printWithDots("Downloading webInstaller", 12)
	
	if fs.exists(filePath) then
		fs.delete(filePath)
	end
	
	local file = fs.open(filePath,"w")
	file.write(installData)
	file.close()
		
	sleep(1)
	printWithDots("Preparing installation", 7)
	sleep(1)
	shell.run(filePath)
else 
	print("Unable to download the file "..webInstallerPath)
	print("Make sure you have the HTTP API enabled or")
	print("an internet connection!")
end

--print("installData: "..tostring(installData))

-- OBSOLETE => webInstaller is not data but a program, needs execution!
-- So instead it has to be saved to disk!
--[[
for line in installData:gmatch("([^\n]*)\n?") do
    print("line: "..line)
end
--]]

